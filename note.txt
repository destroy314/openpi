Ëøô‰∏ÄËÑöÊú¨Â∫îËØ•ÂèØ‰ª•Â∞ÜRDTÁöÑairbot h5Êï∞ÊçÆÈõÜÔºàÁî±convert_data_to_rdt_h5.pyÂàõÂª∫ÔºâËΩ¨‰∏∫lerobotÊ†ºÂºè„ÄÇHFIDÂ∫î‰∏∫‰Ω†ÁöÑhuggingface idÔºå‰∏çËøá‰∏ç‰∏ä‰º†ÁöÑËØùÊó†ÂÖ≥Á¥ßË¶ÅÔºõDATASET‰∏∫Êï∞ÊçÆÈõÜÂêçÁß∞„ÄÇ447Êù°‚úï250Â∏ß‚úï2Áõ∏Êú∫‚âà30min

export PATH=~/yangzhuo/ffmpeg-7.0.2-amd64-static:${PATH}
export LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot

uv run examples/airbot/convert_airbot_data_to_lerobot.py --raw_dir datasets/pick_place --repo_id HFID/DATASET --no-push-to-hub
uv run examples/airbot/convert_raw_airbot_data_to_lerobot.py --raw_dir data/airbot_data_raw --repo_id destroy314/airbot_all --no-push-to-hub
uv run examples/airbot/remove_cache_images.py --root_folder data/lerobot/destroy314/airbot_all/images #Âõ†‰∏∫lerobotÂú®ËΩ¨Êç¢ÂÆåÂêéÊâç‰ºöÂà†Èô§ÂõæÁâáüòÖ
Ê≥®ÊÑèÂΩìÂâçÁöÑairbot_allÊï∞ÊçÆÈõÜÁöÑfpsËÆæÈîô‰∫ÜÔºàÂ∫î‰∏∫25ÔºåÂÆû‰∏∫50ÔºâÔºå‰ΩÜÈô§‰∫ÜÂØºËá¥ËßÜÈ¢ëÊí≠ÊîæÁöÑÊõ¥Âø´Â§ñÂ•ΩÂÉèÊ≤°Êúâ‰∏çÂà©ÂΩ±ÂìçÔºåÂÖà‰∏çÁÆ°‰∫Ü
ËøôÁõ¥Êé•ÂØºËá¥‰∫Ü‰∏ãÈù¢ÁöÑË∂ÖÂá∫toleranceÈîôËØØ„ÄÇÊöÇ‰∏îÊîπ‰∫Üvideo_utils.py decode_video_frames_torchvisionÊäätimestamps‰∏≠ÁöÑÂÄºÈô§2

> TODO
> raw->lerobotÁöÑËΩ¨Êç¢ËÑöÊú¨Ôºàconvert_airbot_data_to_lerobot.pyÔºâÂ∑≤ÁªèÂÜôÂ•Ω‰∫Ü
> ËßÜÈ¢ëÁúãËµ∑Êù•ÊúâÁÇπÈó™ÔºåÂ∏ßÂÜÖÂéãÁº©ÁöÑÂéüÂõ†Ôºü
> 
> Êé•‰∏ãÊù•‰ºöÊ∂âÂèäÂçï/ÂèåËáÇÊï∞ÊçÆÊ∑∑ÂêàËÆ≠ÁªÉ
> a. Ê≠£Â∏∏‰øùÂ≠òÂπ∂‰øÆÊîπcreate_dataset‰ΩøÁî®MultiLeRobotDataset‰ª•Ê∑∑Âêà‰∏çÂêåÊï∞ÊçÆÈõÜÔºà‰ª•ÂêéËøòÊòØÁî®Ëøô‰∏™ÊñπÊ°àÂêßÔºâ
> Êàñ
> b. ÂØπÂçïËáÇÊï∞ÊçÆËøõË°åzero-paddingÔºå‰ΩøÂÖ∂key‰∏éÂèåËáÇ‰øùÊåÅ‰∏ÄËá¥Ôºå‰øùÂ≠òÂú®Âêå‰∏Ä‰∏™lerobot datasetÈáåÔºàpi0fast‰∏çÈúÄË¶ÅËÆæÁΩÆimage_masksÔºåÂè™Áî®Ëøô‰∏™Ê®°ÂûãÂ∞±Ê≤°ÂÖ≥Á≥ªÔºâÔºàÊöÇÂÆöËøô‰∏™ÊñπÊ°àÔºâ
>
> promptÊúÄÂ•Ω‰∏çË¶ÅÂÜôÂú®Êï∞ÊçÆÈõÜÈáåÔºå‰ª•‰æø‰øÆÊîπÔºüÂÜô‰∫Ü‰πüÊå∫Â•ΩÊîπÁöÑ
> Áé∞Âú®ÂÜôÂú®‰∫Üairbot_policy.pyÈáå

ËΩ¨Êç¢ÂêéÁªìÊûÑÂ¶Ç‰∏ãÔºö

~/.cache/huggingface/lerobot/HFID/DATASET
‚îú‚îÄ‚îÄ data
‚îÇ   ‚îú‚îÄ‚îÄ chunk-000
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000000.parquet
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000001.parquet
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000002.parquet
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ meta
‚îÇ   ‚îú‚îÄ‚îÄ episodes.jsonl
‚îÇ   ‚îú‚îÄ‚îÄ info.json
‚îÇ   ‚îú‚îÄ‚îÄ stats.json
‚îÇ   ‚îî‚îÄ‚îÄ tasks.jsonl
‚îî‚îÄ‚îÄ videos
    ‚îú‚îÄ‚îÄ chunk-000
    ‚îÇ   ‚îú‚îÄ‚îÄ observation.images.cam_high
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000000.mp4
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000001.mp4
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ...
    ‚îÇ   ‚îú‚îÄ‚îÄ observation.images.cam_left_wrist
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ ...

ËÆ°ÁÆóÁªüËÆ°‰ø°ÊÅØÔºö

CUDA_VISIBLE_DEVICES=0 uv run scripts/compute_norm_stats.py --config-name CFGNAME
CUDA_VISIBLE_DEVICES=0 uv run scripts/compute_norm_stats.py --config-name pi0_fast_airbot_pick_place_low_mem_finetune
CUDA_VISIBLE_DEVICES=1 HF_ENDPOINT=https://hf-mirror.com LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot uv run scripts/compute_norm_stats.py --config-name pi0_fast_airbot_all

TODO
Ëß£ÂÜ≥Ë∂ÖÂá∫toleranceÁöÑÈóÆÈ¢ò
AssertionError: One or several query timestamps unexpectedly violate the tolerance (tensor([0.1000]) > tolerance_s=0.1).It means that the closest frame that can be loaded from the video is too far away in time.This might be due to synchronization issues with timestamps during data collection.To be safe, we advise to ignore this item during training.
queried timestamps: tensor([16.])
loaded timestamps: tensor([15.8800, 15.9000])
video: /baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot/destroy314/airbot_all/videos/chunk-000/observation.images.cam_high/episode_000020.mp4
.../episode_000031.mp4
backend: pyav
TODO
‰øÆÂ§çÂΩìÂâçÊï∞ÊçÆÈõÜËßÜÈ¢ëÁöÑfps

Ëøô‰ºö‰∫ßÁîü.assets/CFGNAME/HFID/DATASET/norm_stats.jsonÔºåÂπ∂Âú®ÂæÆË∞ÉÊó∂‰ΩøÁî®„ÄÇÂØπ‰∫éÂÖ±‰∫´Êï∞ÊçÆÈõÜÁöÑÂ§ö‰∏™configÔºåÂèØ‰ª•ÊâãÂä®Â§çÂà∂ÂØπÂ∫îÁöÑÁªüËÆ°‰ø°ÊÅØ„ÄÇ

> ÊàñËÄÖÂèØ‰ª•ÂÅö‰∫õÂ∞è‰øÆÊîπÊù•Êñπ‰æø‰∫õ
> ‰øÆÊîπcompute_norm_stats.py L69‰∏∫Ôºö
> output_path = config.data.assets.assets_dir + "/" + data_config.repo_id
> Âú®ÊØè‰∏™TrainConfig‰∏≠ÁöÑdataÁöÑÂàùÂßãÂåñÂèÇÊï∞‰∏≠Ê∑ªÂä†Ôºö
> assets=AssetsConfig(assets_dir="assets"), # Ê≥®ÊÑèÊ≤°ÊúâÁÇπ
> Ê≠§Êó∂ÁªüËÆ°‰ø°ÊÅØ‰ºö‰∫ßÁîüÂú®.assets/HFID/DATASET/norm_stats.jsonÔºåÂèØ‰ª•Êñπ‰æøÁöÑÂú®Â§ö‰∏™configÈó¥ÂÖ±‰∫´

ÂæÆË∞ÉÔºö

CUDA_VISIBLE_DEVICES=5 XLA_PYTHON_CLIENT_MEM_FRACTION=0.99 uv run scripts/train.py pi0_fast_airbot_pick_place_low_mem_finetune --exp-name=pi0_fast_lora_absolute_airbot_pick_place --overwrite --no-wandb_enabled

export HF_ENDPOINT=https://hf-mirror.com
export LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot
export CUDA_VISIBLE_DEVICES=7
export XLA_PYTHON_CLIENT_MEM_FRACTION=0.99

CUDA_VISIBLE_DEVICES=4 HF_ENDPOINT=https://hf-mirror.com LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot XLA_PYTHON_CLIENT_MEM_FRACTION=0.99 uv run scripts/train.py pi0_fast_airbot_all --exp-name=debug --overwrite --no-wandb_enabled
CUDA_VISIBLE_DEVICES=5 HF_ENDPOINT=https://hf-mirror.com LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot XLA_PYTHON_CLIENT_MEM_FRACTION=0.99 uv run scripts/train.py pi0_fast_lora_airbot_all --exp-name=debug --overwrite --no-wandb_enabled

Volcengine:ÊåÇËΩΩvePFSÂíåNas

WANDB_MODE offline
LEROBOT_HOME /baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot
XLA_PYTHON_CLIENT_MEM_FRACTION 0.99
HF_ENDPOINT https://hf-mirror.com

cd /baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/yangzhuo/openpi
/baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/miniconda3/bin/uv run scripts/train.py pi0_fast_lora_airbot_all --exp-name=pi0_fast_lora_airbot --overwrite

cd /baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/yangzhuo/openpi
/baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/miniconda3/bin/uv run scripts/train.py pi0_fast_airbot_all --exp-name=pi0_fast_airbot --overwrite


Êé®ÁêÜÔºö

uv run examples/simple_client/main.py --env ALOHA # test

# in shell 1:
openpi$ uv run scripts/serve_policy.py policy:checkpoint --policy.config=pi0_fast_airbot_pick_place_low_mem_finetune --policy.dir=checkpoints/delta_13k/13000
# in shell 2:
Imitate-All$ python pi0_evaluate_client.py
