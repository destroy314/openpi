ËΩ¨Êç¢Êï∞ÊçÆÈõÜÔºö

export PATH=~/yangzhuo/ffmpeg-7.0.2-amd64-static:${PATH}
export LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot

uv run examples/airbot/convert_airbot_data_to_lerobot.py --raw_dir datasets/pick_place --repo_id HFID/DATASET --no-push-to-hub
uv run examples/airbot/convert_raw_airbot_data_to_lerobot.py --raw_dir data/airbot_data_raw --repo_id destroy314/airbot_all --no-push-to-hub
uv run examples/airbot/remove_cache_images.py --root_folder data/lerobot/destroy314/airbot_all/images #Âõ†‰∏∫lerobotÂú®ËΩ¨Êç¢ÂÆåÂêéÊâç‰ºöÂà†Èô§ÂõæÁâáüòÖ

> TODO
> ‰øÆÊîπcreate_dataset‰ΩøÁî®MultiLeRobotDataset‰ª•Ê∑∑Âêà‰∏çÂêåÊï∞ÊçÆÈõÜ

ËΩ¨Êç¢ÂêéÁªìÊûÑÂ¶Ç‰∏ãÔºö

~/.cache/huggingface/lerobot/HFID/DATASET
‚îú‚îÄ‚îÄ data
‚îÇ   ‚îú‚îÄ‚îÄ chunk-000
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000000.parquet
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000001.parquet
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000002.parquet
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ meta
‚îÇ   ‚îú‚îÄ‚îÄ episodes.jsonl
‚îÇ   ‚îú‚îÄ‚îÄ info.json
‚îÇ   ‚îú‚îÄ‚îÄ stats.json
‚îÇ   ‚îî‚îÄ‚îÄ tasks.jsonl
‚îî‚îÄ‚îÄ videos
    ‚îú‚îÄ‚îÄ chunk-000
    ‚îÇ   ‚îú‚îÄ‚îÄ observation.images.cam_high
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000000.mp4
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ episode_000001.mp4
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ...
    ‚îÇ   ‚îú‚îÄ‚îÄ observation.images.cam_left_wrist
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ ...

ËÆ°ÁÆóÁªüËÆ°‰ø°ÊÅØÔºö

CUDA_VISIBLE_DEVICES=0 uv run scripts/compute_norm_stats.py --config-name CFGNAME
CUDA_VISIBLE_DEVICES=0 uv run scripts/compute_norm_stats.py --config-name pi0_fast_airbot_pick_place_low_mem_finetune
CUDA_VISIBLE_DEVICES=5 HF_ENDPOINT=https://hf-mirror.com LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot uv run scripts/compute_norm_stats.py --config-name pi0_fast_airbot_all

Ëøô‰ºö‰∫ßÁîü.assets/CFGNAME/HFID/DATASET/norm_stats.jsonÔºåÂπ∂Âú®ÂæÆË∞ÉÊó∂‰ΩøÁî®„ÄÇÂØπ‰∫éÂÖ±‰∫´Êï∞ÊçÆÈõÜÁöÑÂ§ö‰∏™configÔºåÂèØ‰ª•ÊâãÂä®Â§çÂà∂ÂØπÂ∫îÁöÑÁªüËÆ°‰ø°ÊÅØ„ÄÇ

> ÊàñËÄÖÂèØ‰ª•ÂÅö‰∫õÂ∞è‰øÆÊîπÊù•Êñπ‰æø‰∫õ
> ‰øÆÊîπcompute_norm_stats.py L69‰∏∫Ôºö
> output_path = config.data.assets.assets_dir + "/" + data_config.repo_id
> Âú®ÊØè‰∏™TrainConfig‰∏≠ÁöÑdataÁöÑÂàùÂßãÂåñÂèÇÊï∞‰∏≠Ê∑ªÂä†Ôºö
> assets=AssetsConfig(assets_dir="assets"), # Ê≥®ÊÑèÊ≤°ÊúâÁÇπ
> Ê≠§Êó∂ÁªüËÆ°‰ø°ÊÅØ‰ºö‰∫ßÁîüÂú®.assets/HFID/DATASET/norm_stats.jsonÔºåÂèØ‰ª•Êñπ‰æøÁöÑÂú®Â§ö‰∏™configÈó¥ÂÖ±‰∫´

ÂæÆË∞ÉÔºö

CUDA_VISIBLE_DEVICES=5 XLA_PYTHON_CLIENT_MEM_FRACTION=0.99 uv run scripts/train.py pi0_fast_airbot_pick_place_low_mem_finetune --exp-name=pi0_fast_lora_absolute_airbot_pick_place --overwrite --no-wandb_enabled

export HF_ENDPOINT=https://hf-mirror.com
export LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot
export CUDA_VISIBLE_DEVICES=7
export XLA_PYTHON_CLIENT_MEM_FRACTION=0.99

CUDA_VISIBLE_DEVICES=4 HF_ENDPOINT=https://hf-mirror.com LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot XLA_PYTHON_CLIENT_MEM_FRACTION=0.99 uv run scripts/train.py pi0_fast_airbot_all --exp-name=debug --overwrite --no-wandb_enabled
CUDA_VISIBLE_DEVICES=5 HF_ENDPOINT=https://hf-mirror.com LEROBOT_HOME=/baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot XLA_PYTHON_CLIENT_MEM_FRACTION=0.99 uv run scripts/train.py pi0_fast_lora_airbot_all --exp-name=debug --overwrite --no-wandb_enabled


ÁÅ´Â±±ÂºïÊìéÔºöÊåÇËΩΩvePFSÂíåNas
WANDB_MODE offline
LEROBOT_HOME /baai-cwm-1/baai_cwm_ml/public_data/scenes/pi0/lerobot
XLA_PYTHON_CLIENT_MEM_FRACTION 0.99
HF_ENDPOINT https://hf-mirror.com

cd /baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/yangzhuo/openpi
/baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/miniconda3/bin/uv run scripts/train.py pi0_fast_lora_airbot_all --exp-name=pi0_fast_lora_airbot_all --checkpoint-base-dir=/baai-cwm-nas/algorithm/zongzheng.zhang/yangzhuo/checkpoints --weight-loader.params-path=/baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/.cache/openpi/openpi-assets/checkpoints/pi0_fast_base/params --overwrite

cd /baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/yangzhuo/openpi
/baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/miniconda3/bin/uv run scripts/train.py pi0_fast_airbot_all --exp-name=pi0_fast_airbot_all --checkpoint-base-dir=/baai-cwm-nas/algorithm/zongzheng.zhang/yangzhuo/checkpoints --weight-loader.params-path=/baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/.cache/openpi/openpi-assets/checkpoints/pi0_fast_base/params --overwrite

chmod -R 777 /baai-cwm-nas/algorithm/zongzheng.zhang/yangzhuo/checkpoints
chmod -R 777 /baai-cwm-1/baai_cwm_ml/algorithm/zongzheng.zhang/yangzhuo/openpi/wandb


cd /baai-cwm-nas/algorithm/zongzheng.zhang/yangzhuo/checkpoints/
cd pi0_fast_lora_airbot_all/pi0_fast_lora_airbot/
tar -cvf pi0_fast_lora_all_20k.tar --exclude="*/train_state" 19999
tosutil cp pi0_fast_lora_all_20k.tar tos://baai-cwm-bucket-01/pi0/
rm pi0_fast_lora_all_20k.tar
tosutil cp tos://baai-cwm-bucket-01/pi0/pi0_fast_lora_all_20k.tar .

Êé®ÁêÜÔºö

# in shell 1:
openpi$ uv run scripts/serve_policy.py policy:checkpoint --policy.config=pi0_fast_airbot_pick_place_low_mem_finetune --policy.dir=checkpoints/fast_lora_pick_place_delta_13k
openpi$ uv run scripts/serve_policy.py policy:checkpoint --policy.config=pi0_fast_airbot_pick_place_low_mem_finetune --policy.dir=checkpoints/fast_lora_pick_place_absolute_13k
openpi$ uv run scripts/serve_policy.py policy:checkpoint --policy.config=pi0_fast_lora_airbot_all --policy.dir=checkpoints/fast_lora_airbot_all_20k
# in shell 2:
Imitate-All$ python pi0_evaluate_client.py [--right]
uv run examples/simple_client/main.py --env ALOHA # for test
